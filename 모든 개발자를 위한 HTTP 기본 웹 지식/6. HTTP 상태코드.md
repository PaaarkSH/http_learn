# HTTP 상태코드

# HTTP 상태코드 소개

## 상태 코드

### 클라이언트가 보낸 요청의 처리 상태를 응답에서 알려주는 기능

- 1xx(Informational): 요청이 수신되어 처리중
- 2xx(Successful): 요청이 정상 처리
- 3xx(Redirection): 요청을 완료하려면 추가 행동이 필요
- 4xx(Client Error): 클라이언트 오류, 잘못된 문법등으로 서버가 요청을 수행할 수 없음
- 5xx(Server Error): 서버 오류, 서버가 정상 요청을 처리하지 못함

## 만약 모르는 상태 코드가 나타난다면?

- 클라이언트가 인식할 수 없는 상태코드를 서버가 반환하면?
- 클라이언트는 상위 상태코드로 해석해서 처리
- 미래에 새로운 상태 코드가 추가되어도 클라이언트를 변경하지 않아도 됨
- 예)
    - 299 ??? → 2xx(Sucessful)
    - 451 ??? → 2xx(ClientError)
    - 599 ??? → 2xx(ServerError)

## 1xx (Informational)

### 요청이 수신되어 처리중

- 거의 사용하지 않으므로 생략
    - 한번도 실무에서 보신적 없으심

# 2xx - 성공

## 2xx(Successful)

### 클라이언트의 요청을 성공적으로 처리

## 200 ok

### 결과를 잘 처리 할 경우 응답 메세지로 200 OK 를 전달

## 201 Created

### 요청 성공해서 새로운 리소스가 생성

- 생성된 리소스는 Location 헤더 필드로 식별
    - Location: /members/100

## 202 Accepted

### 요청이 접수는 되었으나 처리가 완료되지 않았음

- 배치 처리 같은 곳에서 사용
    - 요청 접수 후 1시간 뒤에 배치 프로세스가 요청을 처리함
    - 큐같은거 받았을때 쓰는듯
- 잘 안사용함

## 204 No Content

### 서버가 요청을 성공적으로 수행했지만, 응답 페이로드 본문에 보낼 데이터가 없음

- 문서 편집기에 Save 버튼
- save 버튼 결과로 아무 내용이 없을 경우
    - 같은 화면을 유지해야함
- 결과 내용이 없어도 204 메시지 만으로 성공을 인식 가능

<aside>
💡 사실은 이 모든 상태코드를 사용하는게 좋지는 않음

</aside>

- 거의 200 이나 201 만 사용하는 경우가 많음
- 너무 많으면 구분하기 쉽지 않음

# 3xx - 리다이렉션1

## 3xx (Redirection)

### 요청을 완료하기 위해 유저 에이전트의 추가 조치 필요

- 클라이언트(웹 브라우저)한테 다시 보냄

## 리다이렉션의 이해

### 설명

- 웹 브라우저는 3xx 응답의 결과에 Lcoation 헤더가 있으면, Location 위치로 자동 이동
    - 이게 리다이렉트

### 자동 리다이렉트 흐름

- 이전에 event 페이지의 주소가 /event 였는데 → /new-event 로 변경될때
- 301 응답으로 Location: /new-event 로 변경
- 클라이언트 사용자 입장에서는 너무 빨라서 인식을 못함

### 종류

- **영구 리다이렉션** - 특정 리소스의 URI 가 영구적으로 이동
    - /members → /users
    - /event → /new-event
- **일시 리다이렉션** - 일시적인 변경
    - 주문 완료 후 주문 내역 화면으로 이동
    - PRG: Post/Redirect/Get
- **특수 리다이렉션**
    - 결과 대신 캐시를 사용

## 영구 리다이렉션

### 301 308

- 리소스의 URI 가 영구적으로 이동
- 원래의 url 을 사용 X, 검색 엔진 등에서도 변경 인지
- **301 Moved Permanetly**
    - 리다이렉트시 요청 메소드가 GET 으로 변하고, 본문이 제거될 수 있음(할수도 있다는 말임)
        - Post 로 요청해도 Get으로 변경하고 메세지가 삭제됨
        - 처음에 제작 당시에는 Post 로 보내면 당연히 Post 로 다시 리다이렉트 할줄 알았음
            - 막상 해보니 브라우저가 GET 으로 돌려주는 개발이 되어버림
- **308 Permanent Redirect**
    - 301과 기능은 같음
    - 리다이렉트시 요청 메소드와 본문 유지(처음 POST 를 리다이렉트도 Post 유지)

## 301 Moved Permanetly

- http 통신을 했음
- 서버에서 해당 페이지가 없어서 301 코드와 Location 을 보냄
- GET 으로 새로운 Location 으로 http 요청을 보냄
    - 대신 바디 데이터가 다 사라짐
    - 그러면 결국 처음부터 다시 입력해야되는 폼이 나오거나 새로운 이벤트 페이지 화면이 나오는 방식
- 서버는 새로운 페이지를 보여달라는걸로 이해함

## 308 Permanent Redirect

- 301과 과정은 같은데 GET 으로 새로운 요청을 보내지 않고 기존의 요청을 그대로 유지
- 실무에서는 이렇게 사용안함
    - 301 로 돌려서 사용하는게 좋음

 

## 일시적인 리다이렉션

### 302 307 303

- **리소스의 URI 가 일시적으로 변경**
    - 나중에 안바뀔수도 있음
- 따라서 검색 엔진 등에서 URL 을 변경하면 안됨
- **302 Found**
    - 리다이렉트시 요청 메소드가 GET 으로 변하고, 본문이 제거될 수 있음
    - 301이랑 상황이 같음
    - 처음 의도는 같은 메소드로 돌아올 줄 알았는데 스펙이 잘 안적혀있다보니 이렇게 됬음
    - 제거 될 수도 있다고 써있지만 제거될 가능성이 농후함
    - 디폴트로 사용하고있음
- **307 Temporary Redirect**
    - 302와 기능은 같음
    - 리다이렉트시 요청 메소드와 본문 유지(요청 메소드를 변경하면 안된다)
- **303 See Other**
    - 302와 기능은 같음
    - 리다이렉트시 요청 메소드가 GET 으로 변경
    - 좀 더 명확하게 get 으로 변경하고 싶었음

## PRG: Post Rediect Get

### 일시적인 리다이렉션 - 예시

- POST 로 주문후에 웹 브라우저를 새로고침하면?
    - **post 에 데이터가 서버에 들어가서 중복 주문이 될 가능성이 있음**
- 새로고침은 다시 요청
- 중복 주문이 될 수 있다

### PRG 사용 전

- post 를 통해서 주문 요청을 하면 db 에 1개 저장
- 그리고 ok 를 리턴함
- 결과 화면에서 새로고침을 하면?
- post 요청을 서버에 리다이렉션으로 다시 전송함
- 그러면 주문이 한건 더 들어감
- 그러고 주문 완료가 됨
- **결국 새로 고침을 할때 마다 주문이 계속 들어감**
    - 보통 서버에서 이런건 막아야함
    - 상품 아이디 이런걸 미리 만들어놓고 중복 주문이 오면 클라이언트가 실수로 어떻게 막도록
        - 이미 사용된 주문번호라거나 이런식

### 일시적인 리다이렉션 - 예시

- POST 로 주문후에 새로 고침으로 인한 중복 주문 방지
- POST로 주문 후에 주문 결과를 화면으로 GET 메소드로 리다이렉트
- 새로고침해도 결과 화면을 GET 으로 조회
- 중복 주문 대신 결과 화면만 GET 으로 다시 요청
- **물론 서버에서도 막아야함**

### PRG 사용 후

- 

# 3xx - 리다이렉션2

# 4xx - 클라이언트 오류

# 5xx - 서버 오류